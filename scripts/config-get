#!/usr/bin/env python3
# pylint: disable=invalid-name
"""Read a value from config.yaml using dot notation.

Usage:
    scripts/config-get deploy.domain
    scripts/config-get backup.retention_days
    scripts/config-get app.version
"""
import os
import sys

import yaml


def get_nested(data, key):
    """Traverse nested dict using dot-separated key."""
    for part in key.split("."):
        data = data[part]
    return data


def main():
    if len(sys.argv) != 2:
        print(f"Usage: {sys.argv[0]} <dot.separated.key>", file=sys.stderr)
        sys.exit(1)

    # Search for config.yaml in common locations
    script_dir = os.path.dirname(os.path.abspath(__file__))
    project_dir = os.path.dirname(script_dir)
    candidates = [
        os.path.join(project_dir, "config.yaml"),
        os.path.join(os.getcwd(), "config.yaml"),
        "/app/config.yaml",  # Docker
    ]

    config_path = None
    for path in candidates:
        if os.path.isfile(path):
            config_path = path
            break

    if config_path is None:
        print("config.yaml not found", file=sys.stderr)
        sys.exit(1)

    with open(config_path, encoding="utf-8") as f:
        config = yaml.safe_load(f)

    try:
        value = get_nested(config, sys.argv[1])
        print(value)
    except (KeyError, TypeError):
        print(f"Key not found: {sys.argv[1]}", file=sys.stderr)
        sys.exit(1)


if __name__ == "__main__":
    main()
